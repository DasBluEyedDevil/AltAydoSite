# Requirements Archive: v1.0 Dynamic Ship Database

**Archived:** 2026-02-04
**Status:** SHIPPED

This is the archived requirements specification for v1.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

**Defined:** 2026-02-03
**Core Value:** The ship database is always current with the latest Star Citizen ships and data without any manual maintenance.

## v1 Requirements

Requirements for initial release. Each maps to roadmap phases.

### Sync Engine

- [x] **SYNC-01**: FleetYards API client fetches all ships via paginated GET requests to `/v1/models`
- [x] **SYNC-02**: Sync service transforms FleetYards response into internal ship schema via explicit field mapping
- [x] **SYNC-03**: Ships are upserted to MongoDB `ships` collection keyed on FleetYards UUID
- [x] **SYNC-04**: Sync is triggered via Azure scheduled job (matching existing Discord sync pattern)
- [x] **SYNC-05**: If FleetYards API is unavailable, existing ship data is preserved (never wiped)
- [x] **SYNC-06**: Each ship record is Zod-validated before writing; malformed records are logged and skipped
- [x] **SYNC-07**: Sync audit log records each run: timestamp, ships processed, errors, duration

### Ship Data Model

- [x] **DATA-01**: Ship documents store FleetYards UUID as canonical identifier
- [x] **DATA-02**: Ship documents include: name, slug, manufacturer (name/code/logo), classification, focus, crew min/max, cargo, dimensions, mass, speeds, production status
- [x] **DATA-03**: Ship documents include multiple image URLs: store, angled, side, top views in multiple resolutions
- [x] **DATA-04**: Ship documents include description and external links (RSI store URL)
- [x] **DATA-05**: MongoDB indexes created for: UUID (unique), slug (unique), manufacturer code, production status, text search (name + manufacturer)
- [x] **DATA-06**: `lastSyncedAt` and `syncVersion` tracked per ship for staleness detection

### Ship API

- [x] **API-01**: `GET /api/ships` returns paginated ship list with filter params: manufacturer, size, role, status, search text
- [x] **API-02**: `GET /api/ships/[id]` returns single ship by UUID or slug
- [x] **API-03**: `POST /api/ships/batch` resolves multiple ships by UUID array (for mission rosters, user fleets)
- [x] **API-04**: `GET /api/ships/manufacturers` returns manufacturer list with ship counts

### Migration

- [x] **MIG-01**: Migration script converts all user profile ship references (`user.ships[]`) from name strings to FleetYards UUIDs
- [x] **MIG-02**: Migration script converts all planned mission ship references (`MissionShip`, `MissionParticipant`) to FleetYards UUIDs
- [x] **MIG-03**: Migration script converts all operation participant ship references to FleetYards UUIDs
- [x] **MIG-04**: Migration script converts all resource records (type "Ship") to FleetYards UUIDs
- [x] **MIG-05**: Name matching uses multi-pass strategy: exact match, slug match, RSI name match, contains match, manual override map
- [x] **MIG-06**: Migration script is idempotent (safe to run multiple times)

### Type Updates

- [x] **TYPE-01**: `UserShip` type updated: `fleetyardsId` added, `image` made optional (resolved at render time; removed in Phase 7)
- [x] **TYPE-02**: `MissionShip` type updated with `fleetyardsId` field
- [x] **TYPE-03**: `MissionParticipant` type updated with `fleetyardsId` field
- [x] **TYPE-04**: `OperationParticipant` type updated with `fleetyardsId` field
- [x] **TYPE-05**: `next.config.js` updated with `cdn.fleetyards.net` in `remotePatterns`
- [x] **TYPE-06**: Ship image resolution uses new `resolveShipImage()` that takes ship document and view angle

### Ship Browse & Display

- [x] **UI-01**: Ship list page with multi-axis filtering: manufacturer, size, role/classification, production status, text search -- all combinable
- [x] **UI-02**: Ship detail card/panel shows full specs, description, multiple image views, manufacturer logo, classification
- [x] **UI-03**: Multiple ship image views displayed: angled, side, top, store -- with ability to switch between views
- [x] **UI-04**: Manufacturer logos shown in dropdowns and ship cards -- Validated in Phase 5.1
- [x] **UI-05**: Ship specs displayed on cards: dimensions, crew min/max, cargo SCU, SCM speed -- Validated in Phase 5.1
- [x] **UI-06**: Classification/role labels shown on ship cards (e.g., "Exploration", "Combat", "Freight")
- [x] **UI-07**: Data freshness indicator shows last sync timestamp (e.g., "Last synced: 2 hours ago")
- [x] **UI-08**: Image gallery with thumbnail strip and view angle switcher (angled/side/top/store)

### Frontend Integration

- [x] **INT-01**: Fleet builder (`UserFleetBuilder`) uses `/api/ships` instead of static `getShipsByManufacturer()`
- [x] **INT-02**: Mission planner ship picker uses `/api/ships` with search and filtering
- [x] **INT-03**: Mission detail views resolve ship images from ship documents via FleetYards CDN
- [x] **INT-04**: User profile displays ships with FleetYards images and specs
- [x] **INT-05**: Mission-aware ship cards show relevant specs for mission type (cargo for haul, crew for multi-crew)
- [x] **INT-06**: Org fleet composition dashboard: aggregate view of org fleet by role, size, manufacturer

### Cleanup

- [x] **CLN-01**: `public/data/ships.json` removed
- [x] **CLN-02**: `src/lib/ship-data.ts` (old static loader) removed
- [x] **CLN-03**: `shipManufacturers` array and `formatShipImageName()`/`getShipImagePath()` functions removed from `ShipData.ts`
- [x] **CLN-04**: Old R2 image path resolution helpers removed

## Traceability

| Requirement | Phase | Phase Name | Status |
|-------------|-------|------------|--------|
| SYNC-01 | Phase 1 | Sync Engine & Data Model | Complete |
| SYNC-02 | Phase 1 | Sync Engine & Data Model | Complete |
| SYNC-03 | Phase 1 | Sync Engine & Data Model | Complete |
| SYNC-04 | Phase 1 | Sync Engine & Data Model | Complete |
| SYNC-05 | Phase 1 | Sync Engine & Data Model | Complete |
| SYNC-06 | Phase 1 | Sync Engine & Data Model | Complete |
| SYNC-07 | Phase 1 | Sync Engine & Data Model | Complete |
| DATA-01 | Phase 1 | Sync Engine & Data Model | Complete |
| DATA-02 | Phase 1 | Sync Engine & Data Model | Complete |
| DATA-03 | Phase 1 | Sync Engine & Data Model | Complete |
| DATA-04 | Phase 1 | Sync Engine & Data Model | Complete |
| DATA-05 | Phase 1 | Sync Engine & Data Model | Complete |
| DATA-06 | Phase 1 | Sync Engine & Data Model | Complete |
| API-01 | Phase 2 | Ship API Routes | Complete |
| API-02 | Phase 2 | Ship API Routes | Complete |
| API-03 | Phase 2 | Ship API Routes | Complete |
| API-04 | Phase 2 | Ship API Routes | Complete |
| MIG-01 | Phase 3 | Data Migration | Complete |
| MIG-02 | Phase 3 | Data Migration | Complete |
| MIG-03 | Phase 3 | Data Migration | Complete |
| MIG-04 | Phase 3 | Data Migration | Complete |
| MIG-05 | Phase 3 | Data Migration | Complete |
| MIG-06 | Phase 3 | Data Migration | Complete |
| TYPE-01 | Phase 4 | Type System & Image Resolution | Complete |
| TYPE-02 | Phase 4 | Type System & Image Resolution | Complete |
| TYPE-03 | Phase 4 | Type System & Image Resolution | Complete |
| TYPE-04 | Phase 4 | Type System & Image Resolution | Complete |
| TYPE-05 | Phase 4 | Type System & Image Resolution | Complete |
| TYPE-06 | Phase 4 | Type System & Image Resolution | Complete |
| UI-01 | Phase 5 | Ship Browse & Display | Complete |
| UI-02 | Phase 5 | Ship Browse & Display | Complete |
| UI-03 | Phase 5 | Ship Browse & Display | Complete |
| UI-04 | Phase 5.1 | Ship Browse Gaps | Complete |
| UI-05 | Phase 5.1 | Ship Browse Gaps | Complete |
| UI-06 | Phase 5 | Ship Browse & Display | Complete |
| UI-07 | Phase 5 | Ship Browse & Display | Complete |
| UI-08 | Phase 5 | Ship Browse & Display | Complete |
| INT-01 | Phase 6 | Frontend Integration | Complete |
| INT-02 | Phase 6 | Frontend Integration | Complete |
| INT-03 | Phase 6 | Frontend Integration | Complete |
| INT-04 | Phase 6 | Frontend Integration | Complete |
| INT-05 | Phase 6 | Frontend Integration | Complete |
| INT-06 | Phase 6 | Frontend Integration | Complete |
| CLN-01 | Phase 7 | Cleanup & Decommission | Complete |
| CLN-02 | Phase 7 | Cleanup & Decommission | Complete |
| CLN-03 | Phase 7 | Cleanup & Decommission | Complete |
| CLN-04 | Phase 7 | Cleanup & Decommission | Complete |

**Coverage:**
- v1 requirements: 47 total
- Satisfied: 47
- Unsatisfied: 0

---

## Milestone Summary

**Shipped:** 47 of 47 v1 requirements
**Adjusted:**
- UI-04 and UI-05 initially missed in Phase 5 verification, closed by inserted Phase 5.1
- TYPE-01 `image` field kept as optional during Phase 4, fully removed in Phase 7
**Dropped:** None

---
*Archived: 2026-02-04 as part of v1.0 milestone completion*
