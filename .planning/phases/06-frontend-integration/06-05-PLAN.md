---
phase: 06-frontend-integration
plan: 05
type: execute
wave: 3
depends_on: ["06-01"]
files_modified:
  - src/components/fleet-composition/FleetCompositionPage.tsx
  - src/components/fleet-composition/FleetCompositionTabs.tsx
  - src/components/fleet-composition/FleetBreakdownChart.tsx
  - src/components/fleet-composition/FleetBreakdownTable.tsx
  - src/app/dashboard/fleet-composition/page.tsx
autonomous: true

must_haves:
  truths:
    - "A dedicated route at /dashboard/fleet-composition renders the org fleet composition dashboard"
    - "Dashboard shows three tab views: by Role/Classification, by Manufacturer, by Size Class"
    - "Each view shows a pie chart (distribution) and a bar chart (counts) with percentages"
    - "Clicking a category in the charts/table expands to show individual ship models with counts"
    - "Dashboard data aggregates ships across ALL org members"
    - "Loading state shows skeleton/spinner while fetching users and resolving ships"
  artifacts:
    - path: "src/app/dashboard/fleet-composition/page.tsx"
      provides: "Next.js route for fleet composition dashboard"
    - path: "src/components/fleet-composition/FleetCompositionPage.tsx"
      provides: "Main dashboard page component with data loading"
      exports: ["FleetCompositionPage"]
    - path: "src/components/fleet-composition/FleetCompositionTabs.tsx"
      provides: "Tab switcher for three aggregation axes"
      exports: ["FleetCompositionTabs"]
    - path: "src/components/fleet-composition/FleetBreakdownChart.tsx"
      provides: "Recharts pie and bar chart components"
      exports: ["FleetBreakdownChart"]
    - path: "src/components/fleet-composition/FleetBreakdownTable.tsx"
      provides: "Expandable table for drill-down detail"
      exports: ["FleetBreakdownTable"]
  key_links:
    - from: "src/components/fleet-composition/FleetCompositionPage.tsx"
      to: "src/hooks/useOrgFleet.ts"
      via: "useOrgFleet hook for aggregated data"
      pattern: "useOrgFleet"
    - from: "src/components/fleet-composition/FleetBreakdownChart.tsx"
      to: "recharts"
      via: "PieChart, BarChart, ResponsiveContainer imports"
      pattern: "from 'recharts'"
    - from: "src/app/dashboard/fleet-composition/page.tsx"
      to: "src/components/fleet-composition/FleetCompositionPage.tsx"
      via: "FleetCompositionPage component render"
      pattern: "FleetCompositionPage"
---

<objective>
Build the org fleet composition dashboard as a new dedicated page (INT-06).

Purpose: Provides an at-a-glance view of the org's collective fleet -- what ships the org has, broken down by role, manufacturer, and size. Helps identify fleet strengths and gaps for mission planning.

Output: New route at /dashboard/fleet-composition with Recharts visualizations and drill-down tables.
</objective>

<execution_context>
@C:\Users\dasbl\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dasbl\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-frontend-integration/06-01-SUMMARY.md
@src/hooks/useOrgFleet.ts
@src/app/dashboard/page.tsx
@src/components/ui/mobiglas/MobiGlasPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FleetBreakdownChart and FleetBreakdownTable components</name>
  <files>src/components/fleet-composition/FleetBreakdownChart.tsx, src/components/fleet-composition/FleetBreakdownTable.tsx</files>
  <action>
**Create `src/components/fleet-composition/FleetBreakdownChart.tsx`:**
- 'use client' directive
- Import from recharts: `PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Legend`
- Import `CategoryCount` from `@/hooks/useOrgFleet`
- Props: `{ data: CategoryCount[]; title: string }`
- Define a color palette for chart segments (8-10 colors, MobiGlas-themed):
  ```typescript
  const COLORS = ['#4A90D9', '#50C878', '#FFB347', '#FF6B6B', '#A78BFA', '#F472B6', '#34D399', '#FBBF24', '#60A5FA', '#C084FC'];
  ```
- Render two charts side by side (or stacked on mobile):
  1. **Pie Chart** (left/top):
     - ResponsiveContainer width="100%" height={300}
     - Pie with dataKey="count", nameKey="name"
     - Label showing `{name} ({percent}%)` for slices >5%
     - Cell colors from COLORS array
     - Tooltip showing name + count
     - Legend at bottom
  2. **Bar Chart** (right/bottom):
     - ResponsiveContainer width="100%" height={300}
     - Horizontal bars (layout="vertical") for readability with long category names
     - XAxis type="number", YAxis type="category" dataKey="name"
     - Bar fill using COLORS[0] (primary blue)
     - Tooltip showing count
- Style charts with dark backgrounds matching MobiGlas theme:
  - Tooltip: bg-[rgba(var(--mg-panel-dark),0.95)], text mg-text color
  - Legend text: mg-text color
- Charts should be responsive (stack vertically on mobile, side by side on lg+)

**Create `src/components/fleet-composition/FleetBreakdownTable.tsx`:**
- 'use client' directive
- Import `CategoryCount` from `@/hooks/useOrgFleet`
- Props: `{ data: CategoryCount[]; totalShips: number }`
- Render a table/list of categories:
  - Each row: Category name | Count | Percentage (count/totalShips * 100) | Expand chevron
  - Click row to expand (useState tracking expanded category names as Set<string>)
  - Expanded section: list individual ship models within category with their counts
    - Each sub-row: Ship model name | Count
    - Sorted by count descending
  - Use MobiGlas table styling: mg-panel-dark rows, mg-primary borders, hover effects
- Sort by count descending by default
- Animate expand/collapse with framer-motion AnimatePresence
  </action>
  <verify>Run `npm run type-check` -- no new type errors. Both files exist with correct exports. Recharts imports resolve correctly.</verify>
  <done>FleetBreakdownChart renders pie and bar charts from CategoryCount data. FleetBreakdownTable renders expandable drill-down table.</done>
</task>

<task type="auto">
  <name>Task 2: Create FleetCompositionPage, tabs, and route</name>
  <files>src/components/fleet-composition/FleetCompositionPage.tsx, src/components/fleet-composition/FleetCompositionTabs.tsx, src/app/dashboard/fleet-composition/page.tsx</files>
  <action>
**Create `src/components/fleet-composition/FleetCompositionTabs.tsx`:**
- 'use client' directive
- Props: `{ activeTab: string; onTabChange: (tab: string) => void }`
- Three tabs: "By Role", "By Manufacturer", "By Size"
- Tab bar: horizontal flex with MobiGlas styling
- Active tab: highlighted with mg-primary color, underline indicator
- Inactive tabs: mg-text muted, hover brightens
- Use framer-motion `layoutId` for animated tab indicator underline

**Create `src/components/fleet-composition/FleetCompositionPage.tsx`:**
- 'use client' directive
- Import `useOrgFleet` from `@/hooks/useOrgFleet`
- Import child components: FleetCompositionTabs, FleetBreakdownChart, FleetBreakdownTable
- State: `const [activeTab, setActiveTab] = useState<'role' | 'manufacturer' | 'size'>('role')`
- Call `const { data, isLoading, error } = useOrgFleet()`
- Loading state: full-page skeleton with MobiGlas spinner (matching existing dashboard patterns)
- Error state: MobiGlas error panel with retry button
- When data is loaded:
  - Page header: "FLEET COMPOSITION" title with MobiGlas styling (mg-title)
  - Summary stats bar: Total Ships: {data.totalShips} | Total Members: {data.totalMembers} | Unique Models: {data.shipDetails.size}
  - FleetCompositionTabs component
  - Based on activeTab, select the right data array:
    - 'role': data.byClassification
    - 'manufacturer': data.byManufacturer
    - 'size': data.bySize
  - Render FleetBreakdownChart with selected data
  - Render FleetBreakdownTable with selected data and totalShips
- Wrap the whole page in motion.div with fade-in animation

**Create `src/app/dashboard/fleet-composition/page.tsx`:**
- Server component (no 'use client')
- Import FleetCompositionPage
- Export metadata: `{ title: 'Fleet Composition | AydoCorp' }`
- Render:
  ```tsx
  export default function FleetCompositionRoute() {
    return <FleetCompositionPage />;
  }
  ```
- This follows the same pattern as the fleet-database page.tsx (server wrapper around client component)

NOTE: Do NOT add navigation links to the dashboard sidebar in this plan. That can be done as a follow-up or in Phase 7. The page is accessible directly via URL.
  </action>
  <verify>Run `npm run type-check` -- no new type errors. All files exist. Navigate to /dashboard/fleet-composition in dev server if available -- page should render (may show loading/error if no data, but should not crash).</verify>
  <done>Fleet composition dashboard renders at /dashboard/fleet-composition with three tab views, Recharts visualizations, and expandable drill-down tables.</done>
</task>

</tasks>

<verification>
- `npm run type-check` passes with zero new errors
- `src/app/dashboard/fleet-composition/page.tsx` exists (route accessible)
- `FleetCompositionPage.tsx` uses `useOrgFleet` hook
- `FleetBreakdownChart.tsx` imports from `recharts`
- `FleetBreakdownTable.tsx` supports expand/collapse for drill-down
- `FleetCompositionTabs.tsx` renders three tab options
</verification>

<success_criteria>
Org fleet composition dashboard is accessible at /dashboard/fleet-composition. Shows fleet breakdown by role, manufacturer, and size with charts and drill-down tables. Data aggregated from all org members' ships.
</success_criteria>

<output>
After completion, create `.planning/phases/06-frontend-integration/06-05-SUMMARY.md`
</output>
