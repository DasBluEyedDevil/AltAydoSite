---
phase: 06-frontend-integration
plan: 04
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/ships/ProfileShipCard.tsx
  - src/components/ships/MissionParticipantShip.tsx
  - src/components/profile/UserProfileContent.tsx
  - src/components/fleet-ops/mission-planner/MissionDetail.tsx
autonomous: true

must_haves:
  truths:
    - "User profile page displays fleet ships with FleetYards CDN images, manufacturer logos, and key specs (size, role)"
    - "Clicking a profile ship card expands it in-place to show more details from resolved ShipDocument"
    - "All user ships load at once without pagination on the profile page"
    - "Mission detail view shows participant ships with thumbnail image, name, role, and size class"
    - "Unresolved participant ships (no fleetyardsId or missing from batch) show name and role only, no image or placeholder"
    - "All mission participants are always visible regardless of count"
  artifacts:
    - path: "src/components/ships/ProfileShipCard.tsx"
      provides: "Compact ship card for profile display with inline expand"
      exports: ["ProfileShipCard"]
    - path: "src/components/ships/MissionParticipantShip.tsx"
      provides: "Ship display for mission roster participants"
      exports: ["MissionParticipantShip"]
    - path: "src/components/profile/UserProfileContent.tsx"
      provides: "Rewired profile page with batch-resolved ship display"
    - path: "src/components/fleet-ops/mission-planner/MissionDetail.tsx"
      provides: "Rewired mission detail with batch-resolved participant ships"
  key_links:
    - from: "src/components/profile/UserProfileContent.tsx"
      to: "src/hooks/useShipBatch.ts"
      via: "useShipBatch for fleet resolution"
      pattern: "useShipBatch"
    - from: "src/components/fleet-ops/mission-planner/MissionDetail.tsx"
      to: "src/hooks/useShipBatch.ts"
      via: "useShipBatch for participant ship resolution"
      pattern: "useShipBatch"
    - from: "src/components/ships/ProfileShipCard.tsx"
      to: "src/lib/ships/image.ts"
      via: "resolveShipImage for CDN images"
      pattern: "resolveShipImage"
---

<objective>
Rewire user profile ship display (INT-04) and mission detail participant ships (INT-03, INT-05) to use dynamic ship data.

Purpose: Profile pages currently display ships with legacy images (or none). Mission detail views show participant names but don't resolve ship images from FleetYards CDN. This plan adds batch ship resolution to both views and builds two new display components.

Output: ProfileShipCard and MissionParticipantShip components. Rewired UserProfileContent and MissionDetail.
</objective>

<execution_context>
@C:\Users\dasbl\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dasbl\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-frontend-integration/06-01-SUMMARY.md
@src/components/profile/UserProfileContent.tsx
@src/components/fleet-ops/mission-planner/MissionDetail.tsx
@src/hooks/useShipBatch.ts
@src/lib/ships/image.ts
@src/lib/ships/format.ts
@src/types/user.ts
@src/types/Mission.ts
@src/types/ship.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProfileShipCard and MissionParticipantShip components</name>
  <files>src/components/ships/ProfileShipCard.tsx, src/components/ships/MissionParticipantShip.tsx</files>
  <action>
**Create `src/components/ships/ProfileShipCard.tsx`:**
- 'use client' directive
- Props: `{ ship: UserShip; resolved: ShipDocument | undefined }`
- Compact card (smaller than browse page cards per user's specific idea)
- Layout: horizontal card, ~h-24, with:
  - Ship image thumbnail (80x60px) on left using `resolveShipImage(resolved.images, 'store')` if resolved, else placeholder
  - Ship name (medium text), manufacturer name with logo (14px if resolved.manufacturer.logo exists) below
  - Right side: size badge and classification/role label
- Click handler: toggles expanded state via `useState<boolean>(false)`
- Expanded state (inline expand per locked decision):
  - Slides down below the card using framer-motion `AnimatePresence` + `motion.div`
  - Shows: full specs (crew via formatCrew, cargo via formatCargo, speed via formatSpeed)
  - Shows: description (first 200 chars with "..." truncation)
  - Shows: production status badge
  - If not resolved: expanded section says "Ship details unavailable" in muted text
- Use `resolveShipImage` from `@/lib/ships/image`
- Use `formatCrew`, `formatCargo`, `formatSpeed` from `@/lib/ships/format`
- Image error handling via useState (same pattern as ShipCard from Phase 5)
- Fallback when `resolved` is undefined: show ship.name and ship.manufacturer from UserShip data, no image (or placeholder), no expand functionality

**Create `src/components/ships/MissionParticipantShip.tsx`:**
- 'use client' directive
- Props: `{ participant: MissionParticipant; resolved: ShipDocument | undefined }`
- Import MissionParticipant from `@/types/Mission`
- Thumbnail-style display (compact, for mission roster sidebar):
  - If resolved AND participant has a ship: show 48x32px thumbnail, ship name, size badge, role/classification
  - If NOT resolved but participant.shipName exists: show participant.userName, participant.shipName text, role badges -- NO image, NO placeholder (locked decision: unresolved ships hidden gracefully)
  - If no ship at all: show participant.userName and roles only
- Participant name is always visible (always show userName)
- Role badges from participant.roles array
- INT-05 contextual specs: if resolved, show crew for multi-crew ships (crew.max > 1), cargo for transport/hauling classification
- Use MobiGlas styling: mg-panel-dark background, mg-primary borders, mg-text colors
  </action>
  <verify>Run `npm run type-check` -- no new type errors. Both files exist with correct exports.</verify>
  <done>ProfileShipCard renders compact cards with FleetYards images and inline expand. MissionParticipantShip renders participant ship info with graceful fallback for unresolved ships.</done>
</task>

<task type="auto">
  <name>Task 2: Rewire UserProfileContent and MissionDetail to use batch resolution</name>
  <files>src/components/profile/UserProfileContent.tsx, src/components/fleet-ops/mission-planner/MissionDetail.tsx</files>
  <action>
**UserProfileContent.tsx:**
- Add imports:
  - `useShipBatch` from `@/hooks/useShipBatch`
  - `ProfileShipCard` from `@/components/ships/ProfileShipCard`
  - `{ useMemo }` to React imports
- Add batch resolution in the component body:
  ```typescript
  const fleetyardsIds = useMemo(() => userShips.map(s => s.fleetyardsId).filter(Boolean), [userShips]);
  const { ships: resolvedShips, isLoading: shipsResolving } = useShipBatch(fleetyardsIds);
  ```
- Replace the `{/* Fleet Builder Section */}` area:
  - Keep `UserFleetBuilderWrapper` as-is (it handles add/remove in edit mode)
  - BELOW the fleet builder wrapper, add a "MY FLEET" view-only section that renders when NOT editing:
    - Show all ships at once (no pagination -- locked decision)
    - Map over `userShips` and render `<ProfileShipCard ship={ship} resolved={resolvedShips.get(ship.fleetyardsId)} />` for each
    - Show loading skeleton while `shipsResolving` is true
    - Show "No ships in fleet" empty state if userShips is empty
  - When editing, the fleet builder wrapper handles display (already rewired in Plan 02)
- The profile ship view is READ-ONLY (locked decision: no add/remove on profile, fleet management happens in fleet builder)

**MissionDetail.tsx:**
- Add imports:
  - `useShipBatch` from `@/hooks/useShipBatch`
  - `MissionParticipantShip` from `@/components/ships/MissionParticipantShip`
  - `{ useMemo }` to React imports
- Add batch resolution:
  ```typescript
  const participantShipIds = useMemo(
    () => mission.participants
      .map(p => p.fleetyardsId)
      .filter((id): id is string => !!id && id.length > 0),
    [mission.participants]
  );
  const { ships: resolvedShips } = useShipBatch(participantShipIds);
  ```
- Replace the participant rendering in the "Mission Roster" section (right column):
  - Currently renders participant name + roles + ship name text
  - Replace each participant item with:
    ```tsx
    <MissionParticipantShip
      participant={participant}
      resolved={participant.fleetyardsId ? resolvedShips.get(participant.fleetyardsId) : undefined}
    />
    ```
  - Keep all existing animation variants (framer-motion stagger, hover effects)
  - Keep the "No personnel assigned" empty state
  - All participants always visible (locked decision: no collapsing regardless of count)
  </action>
  <verify>Run `npm run type-check` -- no new type errors. Grep for `useShipBatch` in both files -- confirms import present. Grep for `ProfileShipCard` in UserProfileContent -- confirms usage. Grep for `MissionParticipantShip` in MissionDetail -- confirms usage.</verify>
  <done>Profile displays fleet with FleetYards CDN images and inline expand. Mission detail shows participant ships with thumbnails for resolved ships and graceful fallback for unresolved.</done>
</task>

</tasks>

<verification>
- `npm run type-check` passes with zero new errors
- `ProfileShipCard.tsx` exists and exports `ProfileShipCard`
- `MissionParticipantShip.tsx` exists and exports `MissionParticipantShip`
- `UserProfileContent.tsx` imports and uses `useShipBatch` and `ProfileShipCard`
- `MissionDetail.tsx` imports and uses `useShipBatch` and `MissionParticipantShip`
- No placeholder images shown for unresolved ships in mission detail (graceful fallback)
</verification>

<success_criteria>
Profile pages display ships with FleetYards images and inline expand detail. Mission detail resolves participant ship images from CDN. Unresolved ships degrade gracefully (name/role only).
</success_criteria>

<output>
After completion, create `.planning/phases/06-frontend-integration/06-04-SUMMARY.md`
</output>
