---
phase: 05-ship-browse-and-display
plan: 05
type: execute
wave: 3
depends_on: ["05-02", "05-03", "05-04"]
files_modified:
  - src/components/ships/ShipBrowsePage.tsx
  - src/components/ships/ShipPagination.tsx
  - src/components/ships/SyncStatusIndicator.tsx
  - src/app/dashboard/fleet-database/page.tsx
  - src/app/dashboard/fleet-database/FleetDatabaseClient.tsx
autonomous: false

must_haves:
  truths:
    - "User can browse ships with working filters, search, pagination, and detail panel"
    - "User can filter ships by manufacturer, size, role/classification, and production status simultaneously"
    - "Clicking a ship opens the detail panel with full specs and image gallery"
    - "Traditional pagination with page numbers shows 'Showing 1-24 of 537 ships'"
    - "Data freshness indicator shows last sync time in footer"
    - "Fleet Database page replaces the 'Coming Soon' placeholder"
    - "All components work together as an integrated browsing experience"
  artifacts:
    - path: "src/components/ships/ShipBrowsePage.tsx"
      provides: "Main orchestrator component wiring all sub-components"
      min_lines: 100
    - path: "src/components/ships/ShipPagination.tsx"
      provides: "Page number pagination with result count"
      min_lines: 40
    - path: "src/components/ships/SyncStatusIndicator.tsx"
      provides: "Data freshness footer indicator"
      min_lines: 20
    - path: "src/app/dashboard/fleet-database/page.tsx"
      provides: "Dashboard page entry point"
      min_lines: 10
    - path: "src/app/dashboard/fleet-database/FleetDatabaseClient.tsx"
      provides: "Client component wrapper for the browse page"
      min_lines: 15
  key_links:
    - from: "src/components/ships/ShipBrowsePage.tsx"
      to: "src/hooks/useShips.ts"
      via: "useShips hook with filter state"
      pattern: "useShips"
    - from: "src/components/ships/ShipBrowsePage.tsx"
      to: "src/components/ships/ShipGrid.tsx"
      via: "renders ShipGrid with ship data"
      pattern: "ShipGrid"
    - from: "src/components/ships/ShipBrowsePage.tsx"
      to: "src/components/ships/ShipFilterPanel.tsx"
      via: "renders filter panel with state callbacks"
      pattern: "ShipFilterPanel"
    - from: "src/components/ships/ShipBrowsePage.tsx"
      to: "src/components/ships/ShipDetailPanel.tsx"
      via: "renders detail panel with selected ship ID"
      pattern: "ShipDetailPanel"
    - from: "src/app/dashboard/fleet-database/page.tsx"
      to: "src/app/dashboard/fleet-database/FleetDatabaseClient.tsx"
      via: "renders client component"
      pattern: "FleetDatabaseClient"
---

<objective>
Wire all Phase 5 components together into the complete ship browsing experience. Build the remaining utility components (pagination, sync indicator), create the page orchestrator that manages all state, and replace the "Coming Soon" placeholder with the working fleet database page.

Purpose: This is the integration plan that turns individual components into a working feature. The ShipBrowsePage orchestrator manages filter state, pagination, view mode, and detail panel selection. It connects the useShips hook to the display components and handles all user interactions.

Output: Complete, working fleet database page accessible at /dashboard/fleet-database.
</objective>

<execution_context>
@C:\Users\dasbl\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dasbl\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/05-ship-browse-and-display/05-RESEARCH.md
@.planning/phases/05-ship-browse-and-display/05-CONTEXT.md
@.planning/phases/05-ship-browse-and-display/05-01-SUMMARY.md
@.planning/phases/05-ship-browse-and-display/05-02-SUMMARY.md
@.planning/phases/05-ship-browse-and-display/05-03-SUMMARY.md
@.planning/phases/05-ship-browse-and-display/05-04-SUMMARY.md

Key source files:
@src/hooks/useShips.ts (data hook from Plan 01)
@src/hooks/useSyncStatus.ts (sync status hook from Plan 01)
@src/components/ships/ShipGrid.tsx (from Plan 02)
@src/components/ships/ShipFilterPanel.tsx (from Plan 03)
@src/components/ships/ShipFilterChips.tsx (from Plan 03)
@src/components/ships/ShipSearchBar.tsx (from Plan 03)
@src/components/ships/ShipDetailPanel.tsx (from Plan 04)
@src/app/dashboard/fleet-database/page.tsx (existing "Coming Soon" to replace)
</context>

<tasks>

<task type="auto">
  <name>Task 1: ShipPagination and SyncStatusIndicator components</name>
  <files>
    src/components/ships/ShipPagination.tsx
    src/components/ships/SyncStatusIndicator.tsx
  </files>
  <action>
    Create src/components/ships/ShipPagination.tsx:
    - 'use client' directive
    - Props: `{ page: number; totalPages: number; total: number; pageSize: number; onPageChange: (page: number) => void; }`
    - Result count display: "Showing {start}-{end} of {total} ships" where start = (page-1)*pageSize+1, end = Math.min(page*pageSize, total)
      - Style: text-[rgba(var(--mg-text),0.6)] text-sm
    - Page number buttons in a flex row:
      - Previous button (<): MobiGlasButton ghost size sm, disabled when page === 1
      - Page number buttons: show up to 7 page numbers with ellipsis logic
        - Always show first page, last page, and pages around current (current-1, current, current+1)
        - Ellipsis (...) between gaps, rendered as text-[rgba(var(--mg-text),0.4)]
        - Current page: bg-[rgba(var(--mg-primary),0.2)] border border-[rgba(var(--mg-primary),0.5)] text-[rgba(var(--mg-primary),1)]
        - Other pages: MobiGlasButton ghost size sm
      - Next button (>): MobiGlasButton ghost size sm, disabled when page === totalPages
    - Layout: flex justify-between items-center (count on left, buttons on right)
    - If totalPages <= 1, still show the result count but hide the page buttons

    Create src/components/ships/SyncStatusIndicator.tsx:
    - 'use client' directive
    - Props: none (self-contained, uses useSyncStatus hook internally)
    - Import useSyncStatus from @/hooks/useSyncStatus
    - Import formatRelativeTime from @/lib/ships/format
    - Render: subtle footer text
      - When syncStatus exists: "Last synced: {formatRelativeTime(syncStatus.lastSyncAt)}" with a small dot indicator
        - status 'success': dot is bg-[rgba(var(--mg-success),0.8)]
        - status 'partial': dot is bg-[rgba(var(--mg-warning),0.8)]
        - status 'failed': dot is bg-[rgba(var(--mg-danger),0.8)]
      - When loading or no data: render nothing (return null) -- non-critical, should not show loading state
      - Style: text-[rgba(var(--mg-text),0.4)] text-xs flex items-center gap-1.5
      - Dot: w-1.5 h-1.5 rounded-full inline-block
  </action>
  <verify>Run `npm run type-check` -- no errors in both files.</verify>
  <done>ShipPagination shows "Showing X-Y of Z ships" with page number buttons and ellipsis. SyncStatusIndicator shows "Last synced: 2 hours ago" with color-coded status dot.</done>
</task>

<task type="auto">
  <name>Task 2: ShipBrowsePage orchestrator and page replacement</name>
  <files>
    src/components/ships/ShipBrowsePage.tsx
    src/app/dashboard/fleet-database/FleetDatabaseClient.tsx
    src/app/dashboard/fleet-database/page.tsx
  </files>
  <action>
    Create src/components/ships/ShipBrowsePage.tsx (main orchestrator):
    - 'use client' directive
    - This is the central state management component. It owns ALL state and passes it down.
    - State management using useReducer for filter state to avoid stale closures (RESEARCH.md pitfall #2):
      ```
      type FilterState = {
        page: number;
        pageSize: number;
        manufacturer: string;
        size: string;
        classification: string;
        productionStatus: string;
        search: string;
        viewMode: 'grid' | 'list';
        filterPanelOpen: boolean;
        selectedShipId: string | null;
      };
      ```
      - Actions: SET_FILTER (key + value, resets page to 1), SET_PAGE, SET_VIEW_MODE, TOGGLE_FILTER_PANEL, SELECT_SHIP, CLEAR_FILTERS, SET_SEARCH (resets page to 1)
      - Initial state: page 1, pageSize 24, all filters empty, viewMode 'grid', filterPanelOpen false, selectedShipId null
    - Use useShips hook with filter state (pass page, pageSize, manufacturer, size, classification, productionStatus, search)
    - Compute filter labels for chips: resolve manufacturer slug back to name using a local lookup (fetched from the ShipFilterPanel's manufacturer list, or keep a local ref). For size/classification/productionStatus, use format functions.
    - Layout (top to bottom, inside a single column container):
      1. **Page header**: flex justify-between items-center mb-4
         - Title: "Fleet Database" in text-[rgba(var(--mg-primary),0.9)] text-xl font-quantify
         - Subtitle: text-[rgba(var(--mg-text),0.6)] text-sm
      2. **Search bar**: ShipSearchBar, full width, mb-3
      3. **Filter panel**: ShipFilterPanel with filter state and callbacks
      4. **Filter chips**: ShipFilterChips showing active filters (between filter panel and grid)
      5. **Ship grid**: ShipGrid with ships data, loading state, view mode, callbacks
      6. **Pagination**: ShipPagination with page data from useShips result (only show when data exists)
      7. **Sync status**: SyncStatusIndicator in a footer area, mt-4 text-center
    - Detail panel: ShipDetailPanel rendered with selectedShipId and onClose callback (renders at page level, not inside the grid)
    - When a filter changes: dispatch SET_FILTER which resets page to 1 (important: changing filters should return to page 1)
    - When search changes: dispatch SET_SEARCH which resets page to 1

    Create src/app/dashboard/fleet-database/FleetDatabaseClient.tsx:
    - 'use client' directive
    - Simple wrapper that renders ShipBrowsePage
    - Import ShipBrowsePage from '@/components/ships/ShipBrowsePage'
    - Export default function FleetDatabaseClient that returns <ShipBrowsePage />

    Replace src/app/dashboard/fleet-database/page.tsx:
    - Keep 'use client' directive
    - Keep useSession check for authentication (matches existing pattern -- dashboard pages require auth)
    - Keep loading state with mg-loader
    - Keep access denied state for unauthenticated users
    - Replace the "Coming Soon" MobiGlasPanel content with: `<FleetDatabaseClient />`
    - Remove the old h1/p header (ShipBrowsePage has its own header)
    - Keep the outer div with min-h-screen p-4 md:p-8
    - Import FleetDatabaseClient from './FleetDatabaseClient'
  </action>
  <verify>
    Run `npm run type-check` -- no errors in all three files.
    Start dev server (`npm run dev`) and navigate to /dashboard/fleet-database -- page should render (after login).
  </verify>
  <done>
    ShipBrowsePage orchestrates all components with centralized state management. FleetDatabaseClient wraps it as a client component. The page.tsx replaces the "Coming Soon" placeholder. Users can browse, filter, search, paginate, and inspect ships through the complete integrated UI.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete ship browsing UI at /dashboard/fleet-database with multi-axis filtering, text search, grid/list toggle, pagination, slide-out detail panel with image gallery, and sync status indicator.</what-built>
  <how-to-verify>
    1. Start the dev server: `npm run dev`
    2. Navigate to http://localhost:3000/dashboard/fleet-database (log in if required)
    3. Verify the page loads ships in a grid layout (not "Coming Soon")
    4. Test grid/list view toggle -- both should display ship cards
    5. Open the filter panel and select a manufacturer -- results should narrow
    6. Type in the search bar -- results should narrow after a brief debounce
    7. Combine multiple filters (manufacturer + size) -- results should narrow further
    8. Check filter chips appear when panel is collapsed, and removing a chip clears that filter
    9. Click a ship card -- detail panel should slide in from right
    10. In the detail panel: verify image gallery thumbnails switch the main image
    11. Verify specs section shows formatted values (not raw numbers)
    12. Expand the description section if available
    13. Close the panel via X button, backdrop click, and Escape key
    14. Test pagination -- navigate to page 2, verify different ships appear
    15. Check "Showing X-Y of Z ships" updates correctly
    16. Verify "Last synced" footer text appears
    17. Verify all UI matches MobiGlas theme (cyan/blue color scheme, dark backgrounds)
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 5, or describe any issues to fix.</resume-signal>
</task>

</tasks>

<verification>
- `npm run type-check` passes with zero errors across all Phase 5 files
- Fleet Database page loads at /dashboard/fleet-database (no longer shows "Coming Soon")
- All 8 UI requirements (UI-01 through UI-08) are addressed:
  - UI-01: Multi-axis filtering with text search (ShipFilterPanel + ShipSearchBar)
  - UI-02: Ship detail panel with full specs (ShipDetailPanel + ShipSpecs)
  - UI-03: Multiple image views with switching (ShipImageGallery)
  - UI-04: Manufacturer info in cards and detail panel
  - UI-05: Ship specs on cards and detail panel (ShipSpecs)
  - UI-06: Classification/role labels on ship cards (ShipCard badge)
  - UI-07: Data freshness indicator (SyncStatusIndicator)
  - UI-08: Image gallery with thumbnail strip (ShipImageGallery)
</verification>

<success_criteria>
- Complete ship browsing experience works end-to-end
- Filter state resets page to 1 when filters change
- Pagination shows correct result counts
- Detail panel opens/closes smoothly
- All components use MobiGlas theme consistently
- No TypeScript errors across all new files
- User approves the visual/functional verification
</success_criteria>

<output>
After completion, create `.planning/phases/05-ship-browse-and-display/05-05-SUMMARY.md`
</output>
