---
phase: 05-ship-browse-and-display
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/ships/ShipFilterPanel.tsx
  - src/components/ships/ShipFilterChips.tsx
  - src/components/ships/ShipSearchBar.tsx
autonomous: true

must_haves:
  truths:
    - "User can filter ships by manufacturer, size, role/classification, and production status simultaneously"
    - "Text search narrows results within active filter selections in real time"
    - "Filter panel collapses to maximize browse space"
    - "Active filters shown as removable chips when panel is collapsed"
    - "Manufacturer filter sends slug to API (not display name)"
  artifacts:
    - path: "src/components/ships/ShipFilterPanel.tsx"
      provides: "Collapsible multi-axis filter panel"
      min_lines: 80
    - path: "src/components/ships/ShipFilterChips.tsx"
      provides: "Active filter chip display with remove buttons"
      min_lines: 30
    - path: "src/components/ships/ShipSearchBar.tsx"
      provides: "Debounced text search input"
      min_lines: 30
  key_links:
    - from: "src/components/ships/ShipFilterPanel.tsx"
      to: "/api/ships/manufacturers"
      via: "fetch manufacturer list for dropdown"
      pattern: "fetch.*api/ships/manufacturers"
    - from: "src/components/ships/ShipSearchBar.tsx"
      to: "parent component"
      via: "onSearch callback with debounced value"
      pattern: "onSearch"
    - from: "src/components/ships/ShipFilterChips.tsx"
      to: "parent component"
      via: "onRemove callback for each active filter"
      pattern: "onRemove"
---

<objective>
Build the filter and search components that let users narrow ship results by manufacturer, size, classification, production status, and text search. All filters are combinable (AND logic) and session-only.

Purpose: The ship database has 500+ ships. Without filtering, browsing is impractical. These components provide the primary interaction model for finding specific ships. The collapsible panel design (user decision) maximizes browse space while keeping filters accessible.

Output: Three components -- ShipFilterPanel (collapsible dropdowns), ShipFilterChips (active filter tags), ShipSearchBar (debounced text input).
</objective>

<execution_context>
@C:\Users\dasbl\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dasbl\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/05-ship-browse-and-display/05-RESEARCH.md
@.planning/phases/05-ship-browse-and-display/05-CONTEXT.md
@.planning/phases/05-ship-browse-and-display/05-01-SUMMARY.md

Key source files:
@src/types/ship.ts (ShipDocument -- size, classification, productionStatus fields)
@src/lib/ships/format.ts (formatProductionStatus, formatSize -- from Plan 01)
@src/app/api/ships/manufacturers/route.ts (manufacturer endpoint response shape)
@src/components/ui/mobiglas/MobiGlasPanel.tsx (panel for filter container)
@src/components/ui/mobiglas/MobiGlasButton.tsx (buttons for toggle/clear)
@src/components/ui/mobiglas/MobiGlasInput.tsx (input pattern reference -- but use custom search input)
</context>

<tasks>

<task type="auto">
  <name>Task 1: ShipSearchBar with debounce</name>
  <files>src/components/ships/ShipSearchBar.tsx</files>
  <action>
    Create src/components/ships/ShipSearchBar.tsx:
    - 'use client' directive
    - Props: `{ value: string; onChange: (value: string) => void; }`
    - Internal state: `localValue` synced to `value` prop on mount and when value changes externally
    - Debounce mechanism: useEffect with 300ms setTimeout on localValue changes, calls onChange with the debounced value. Clear timeout on cleanup or when localValue changes again.
    - Input element styled to match MobiGlas theme:
      - w-full px-4 py-2.5 bg-[rgba(var(--mg-background),0.6)] border border-[rgba(var(--mg-primary),0.3)] rounded-sm
      - text-white text-sm placeholder:text-[rgba(var(--mg-text),0.4)]
      - focus:outline-none focus:ring-1 focus:ring-[rgba(var(--mg-primary),0.5)] focus:border-[rgba(var(--mg-primary),0.5)]
      - transition-all
    - Search icon (MagnifyingGlassIcon from @heroicons/react/24/outline) positioned absolute left inside input (pl-10 on input, icon at left-3)
    - Clear button (XMarkIcon) appears on right side when localValue is non-empty, clicking it sets localValue to '' (which debounces to onChange(''))
    - placeholder text: "Search ships by name..."
    - Corner accents matching MobiGlasInput pattern (4 small border elements at corners)
  </action>
  <verify>Run `npm run type-check` -- no errors in ShipSearchBar.tsx.</verify>
  <done>Search input debounces at 300ms, shows search icon, has clear button, matches MobiGlas styling.</done>
</task>

<task type="auto">
  <name>Task 2: ShipFilterPanel and ShipFilterChips</name>
  <files>
    src/components/ships/ShipFilterPanel.tsx
    src/components/ships/ShipFilterChips.tsx
  </files>
  <action>
    Create src/components/ships/ShipFilterPanel.tsx:
    - 'use client' directive
    - Props interface:
      ```
      {
        filters: {
          manufacturer: string;
          size: string;
          classification: string;
          productionStatus: string;
        };
        onFilterChange: (key: string, value: string) => void;
        onClearAll: () => void;
        isOpen: boolean;
        onToggle: () => void;
      }
      ```
    - Collapsible panel using Framer Motion AnimatePresence:
      - Toggle button at top: MobiGlasButton ghost variant with FunnelIcon + "Filters" text + ChevronDownIcon that rotates 180deg when open
      - When open: animated div slides down revealing filter dropdowns
      - When closed: panel collapses with exit animation
    - Four filter dropdowns inside the panel, laid out in a responsive grid (grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3):
      1. **Manufacturer**: Fetches options from `/api/ships/manufacturers` on mount. Stores manufacturer objects { name, slug, shipCount }. Displays `name (shipCount)` but sends `slug` as filter value. CRITICAL: send slug, not name.
      2. **Size**: Hardcoded options matching Star Citizen ship sizes: ["vehicle", "snub", "small", "medium", "large", "capital"]. Display with formatSize() from format.ts.
      3. **Classification**: Hardcoded common values: ["combat", "transport", "exploration", "industrial", "support", "competition", "multi_role", "ground"]. Display with title case.
      4. **Production Status**: Hardcoded: ["flight-ready", "in-production", "in-concept"]. Display with formatProductionStatus() from format.ts.
    - Each dropdown is a styled select element:
      - bg-[rgba(var(--mg-background),0.6)] border border-[rgba(var(--mg-primary),0.3)] rounded-sm
      - text-[rgba(var(--mg-text),0.8)] text-sm py-2 px-3
      - First option is placeholder: "All Manufacturers", "All Sizes", etc.
      - Selecting the placeholder option clears that filter (sends empty string)
    - Labels above each dropdown: text-[rgba(var(--mg-text),0.6)] text-xs uppercase tracking-wider font-quantify mb-1
    - "Clear All" button (MobiGlasButton ghost size sm) appears when any filter is active, calls onClearAll

    Create src/components/ships/ShipFilterChips.tsx:
    - 'use client' directive
    - Props: `{ filters: Record<string, string>; labels: Record<string, string>; onRemove: (key: string) => void; }`
    - `labels` maps filter keys to display values (e.g., { manufacturer: "Aegis Dynamics", size: "Large" }) -- the parent component is responsible for resolving slugs to display names
    - Renders a flex-wrap row of removable chips for each active (non-empty) filter
    - Each chip: inline-flex items-center gap-1 px-2 py-1 text-xs bg-[rgba(var(--mg-primary),0.15)] border border-[rgba(var(--mg-primary),0.3)] text-[rgba(var(--mg-primary),0.9)] rounded-sm
    - Chip shows: filter label (e.g., "Manufacturer: Aegis Dynamics")
    - Remove button (XMarkIcon 12px) on each chip, hover changes to text-[rgba(var(--mg-danger),0.9)]
    - Use AnimatePresence with motion.span for chip enter/exit animations (scale 0.8->1 on enter, scale 1->0.8 on exit)
    - If no active filters, render nothing (return null)
  </action>
  <verify>
    Run `npm run type-check` -- no errors in both files.
    Verify ShipFilterPanel fetches from /api/ships/manufacturers and uses slug values.
  </verify>
  <done>
    ShipFilterPanel provides collapsible multi-axis filtering with manufacturer (from API), size, classification, and production status dropdowns. ShipFilterChips displays removable tags for active filters. Manufacturer filter correctly sends slug values to API.
  </done>
</task>

</tasks>

<verification>
- `npm run type-check` passes with zero errors
- ShipFilterPanel fetches manufacturers from API (not hardcoded)
- Manufacturer filter sends slug to API, displays name in dropdown
- Search debounces at 300ms (not on every keystroke)
- All components are 'use client'
- All colors use MobiGlas CSS variables
- Filter state is NOT persisted to URL (session-only per user decision)
</verification>

<success_criteria>
- Filter panel opens/closes with animation
- All four filter axes render with appropriate options
- Text search input debounces before calling onChange
- Active filters display as removable chips
- Clearing a chip removes that filter
- "Clear All" removes all filters at once
- Manufacturer dropdown shows name but filter sends slug
</success_criteria>

<output>
After completion, create `.planning/phases/05-ship-browse-and-display/05-03-SUMMARY.md`
</output>
