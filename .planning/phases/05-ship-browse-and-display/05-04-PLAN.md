---
phase: 05-ship-browse-and-display
plan: 04
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/ships/ShipDetailPanel.tsx
  - src/components/ships/ShipImageGallery.tsx
  - src/components/ships/ShipSpecs.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking a ship opens a slide-out detail panel from the right side"
    - "Detail panel shows ship name, manufacturer, full specs, description, classification, and production status"
    - "Image gallery displays multiple angles (angled, side, top, store) with thumbnail strip"
    - "Clicking a thumbnail swaps the main image"
    - "Ship description is in a collapsible section (specs visible by default)"
    - "Panel preserves browse context (not a new page)"
  artifacts:
    - path: "src/components/ships/ShipDetailPanel.tsx"
      provides: "Slide-out detail panel with backdrop overlay"
      min_lines: 80
    - path: "src/components/ships/ShipImageGallery.tsx"
      provides: "Main image with thumbnail strip for view switching"
      min_lines: 50
    - path: "src/components/ships/ShipSpecs.tsx"
      provides: "Ship specifications display (dimensions, crew, cargo, speed)"
      min_lines: 40
  key_links:
    - from: "src/components/ships/ShipDetailPanel.tsx"
      to: "src/hooks/useShipDetail.ts"
      via: "fetches full ship data by ID"
      pattern: "useShipDetail"
    - from: "src/components/ships/ShipImageGallery.tsx"
      to: "@/lib/ships/image"
      via: "resolveShipImage for each view angle"
      pattern: "resolveShipImage"
    - from: "src/components/ships/ShipSpecs.tsx"
      to: "@/lib/ships/format"
      via: "format utilities for dimensions, crew, cargo, speed"
      pattern: "formatDimensions|formatCrew|formatCargo|formatSpeed"
---

<objective>
Build the ship detail panel that slides out from the right when a user clicks a ship card. Contains a full-spec view with image gallery, specifications table, and collapsible description.

Purpose: The detail panel is the primary inspection interface. Users click a ship card to see everything about that ship without leaving the browse page. The slide-out design (user decision) preserves browse context. The image gallery lets users see the ship from multiple angles.

Output: Three components -- ShipDetailPanel (slide-out container), ShipImageGallery (image viewer with thumbnails), ShipSpecs (formatted specifications display).
</objective>

<execution_context>
@C:\Users\dasbl\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dasbl\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/05-ship-browse-and-display/05-RESEARCH.md
@.planning/phases/05-ship-browse-and-display/05-CONTEXT.md
@.planning/phases/05-ship-browse-and-display/05-01-SUMMARY.md

Key source files:
@src/types/ship.ts (ShipDocument interface -- all fields available)
@src/lib/ships/image.ts (resolveShipImage, ShipImageView, ShipImages, getShipPlaceholder)
@src/lib/ships/format.ts (all format utilities from Plan 01)
@src/hooks/useShipDetail.ts (from Plan 01)
@src/components/ui/mobiglas/MobiGlasPanel.tsx (panel component)
@src/components/ui/mobiglas/MobiGlasButton.tsx (button component)
</context>

<tasks>

<task type="auto">
  <name>Task 1: ShipImageGallery and ShipSpecs components</name>
  <files>
    src/components/ships/ShipImageGallery.tsx
    src/components/ships/ShipSpecs.tsx
  </files>
  <action>
    Create src/components/ships/ShipImageGallery.tsx:
    - 'use client' directive
    - Props: `{ images: ShipImages; shipName: string; }` (import ShipImages from @/lib/ships/image)
    - State: `activeView: ShipImageView` (default 'angled')
    - Define available views array: filter the four view types (angled, side, top, store) to only those that have non-null URLs. Build this from images object by checking each view type via resolveShipImage and comparing against placeholder.
      - Better approach: define `const views: { view: ShipImageView; label: string }[] = [{ view: 'angled', label: 'Angled' }, { view: 'side', label: 'Side' }, { view: 'top', label: 'Top' }, { view: 'store', label: 'Store' }]`
      - Show all four thumbnails regardless (resolveShipImage handles fallbacks)
    - Main image area: relative container with aspect-[16/10], Next/Image with fill, object-contain, resolveShipImage(images, activeView), sizes="480px", loading="eager"
      - Add onError handler that swaps to placeholder
      - Background: bg-[rgba(var(--mg-dark),0.6)]
    - Thumbnail strip below main image: flex row with gap-2, centered
      - Each thumbnail: relative w-16 h-10 (64x40px), cursor-pointer, border-2
      - Active thumbnail: border-[rgba(var(--mg-primary),0.8)]
      - Inactive thumbnail: border-[rgba(var(--mg-primary),0.2)] hover:border-[rgba(var(--mg-primary),0.4)]
      - Next/Image inside each thumbnail: fill, object-cover, resolveShipImage(images, view)
      - Label below each thumbnail: text-[rgba(var(--mg-text),0.5)] text-[10px] text-center uppercase
      - onClick sets activeView to that view
    - Smooth transition on main image change: use AnimatePresence with key={activeView}, fade in/out

    Create src/components/ships/ShipSpecs.tsx:
    - 'use client' directive
    - Props: `{ ship: ShipDocument; }`
    - Import format functions from @/lib/ships/format: formatDimensions, formatCrew, formatCargo, formatSpeed, formatProductionStatus, formatSize
    - Render a specs grid with two columns (grid grid-cols-2 gap-x-4 gap-y-2):
      - Each spec row: label (text-[rgba(var(--mg-text),0.5)] text-xs uppercase tracking-wider) and value (text-[rgba(var(--mg-text),0.9)] text-sm)
      - Specs to display:
        1. Size: formatSize(ship.size)
        2. Classification: ship.classificationLabel (or ship.classification if label empty)
        3. Focus: ship.focus
        4. Status: formatProductionStatus(ship.productionStatus)
        5. Crew: formatCrew(ship.crew.min, ship.crew.max)
        6. Cargo: formatCargo(ship.cargo)
        7. Dimensions: formatDimensions(ship.length, ship.beam, ship.height)
        8. Mass: ship.mass > 0 ? `${ship.mass.toLocaleString()} kg` : 'N/A'
        9. SCM Speed: formatSpeed(ship.scmSpeed)
        10. Pledge Price: ship.pledgePrice ? `$${ship.pledgePrice}` : 'N/A'
    - Manufacturer section above specs: flex row with manufacturer code badge (bg-[rgba(var(--mg-primary),0.1)] text-[rgba(var(--mg-primary),0.8)] px-2 py-0.5 text-xs font-mono rounded-sm) and manufacturer name
  </action>
  <verify>Run `npm run type-check` -- no errors in both files.</verify>
  <done>ShipImageGallery shows main image with 4-thumbnail strip for view switching. ShipSpecs displays all key specifications in a formatted grid with manufacturer info.</done>
</task>

<task type="auto">
  <name>Task 2: ShipDetailPanel slide-out container</name>
  <files>src/components/ships/ShipDetailPanel.tsx</files>
  <action>
    Create src/components/ships/ShipDetailPanel.tsx:
    - 'use client' directive
    - Props: `{ shipId: string | null; onClose: () => void; }`
    - Use useShipDetail(shipId) hook from Plan 01 to fetch full ship data
    - Render structure (only when shipId is truthy):
      - Backdrop overlay: fixed inset-0, bg-black/50, z-50, onClick calls onClose
      - Panel: fixed right-0 top-0 bottom-0, w-[480px] max-w-full (responsive), z-[60], bg-[rgba(var(--mg-background),0.95)] border-l border-[rgba(var(--mg-primary),0.3)], overflow-y-auto
    - Use Framer Motion AnimatePresence wrapping the entire render
      - Backdrop: motion.div with initial={{ opacity: 0 }}, animate={{ opacity: 1 }}, exit={{ opacity: 0 }}
      - Panel: motion.div with initial={{ x: '100%' }}, animate={{ x: 0 }}, exit={{ x: '100%' }}, transition={{ type: 'tween', duration: 0.3 }}
    - Panel content layout (top to bottom):
      1. **Header**: sticky top-0 z-10, bg-[rgba(var(--mg-background),0.95)] backdrop-blur-sm, flex justify-between items-center, p-4 border-b border-[rgba(var(--mg-primary),0.2)]
         - Ship name: text-[rgba(var(--mg-primary),0.9)] text-lg font-quantify truncate
         - Close button: MobiGlasButton ghost size sm with XMarkIcon
      2. **Image gallery**: ShipImageGallery component with ship.images and ship.name (p-4)
      3. **Manufacturer + status bar**: flex row showing manufacturer code badge + manufacturer name + production status badge (px-4)
         - Production status badge color: "flight-ready" -> --mg-success, "in-concept" -> --mg-warning, "in-production" -> --mg-primary
      4. **Specs section**: ShipSpecs component with ship data (p-4)
      5. **Description section**: collapsible (default collapsed)
         - Toggle button: flex row with "Description" text and ChevronDownIcon that rotates
         - When expanded: ship.description rendered in text-[rgba(var(--mg-text),0.7)] text-sm leading-relaxed p-4
         - If ship.description is null/empty, hide the entire section
         - Use Framer Motion for expand/collapse animation
    - Loading state: when useShipDetail.isLoading is true, show loading skeleton inside panel:
      - Skeleton image area (aspect-[16/10] animate-pulse bg-[rgba(var(--mg-primary),0.08)])
      - Several skeleton text lines
    - Error state: if useShipDetail.error, show error message with retry hint
    - Close on Escape key: add useEffect with keydown listener for 'Escape', calls onClose. Cleanup on unmount.
  </action>
  <verify>
    Run `npm run type-check` -- no errors in ShipDetailPanel.tsx.
    Verify it imports useShipDetail, ShipImageGallery, and ShipSpecs correctly.
  </verify>
  <done>
    ShipDetailPanel slides in from right with backdrop, shows ship header, image gallery with view switcher, manufacturer info, full specs, and collapsible description. Closes on backdrop click, close button, or Escape key. Shows loading skeleton while fetching.
  </done>
</task>

</tasks>

<verification>
- `npm run type-check` passes with zero errors
- ShipDetailPanel uses z-50 for backdrop and z-[60] for panel (avoids sidebar overlap per RESEARCH.md pitfall)
- All images use resolveShipImage() with onError fallback
- Format utilities used for all spec display values
- Description section is collapsible (specs visible by default per user decision)
- Panel slides from right side (not modal, not new page per user decision)
- Escape key closes panel
</verification>

<success_criteria>
- Slide-out panel appears from right with smooth animation
- Panel shows full ship information hierarchy: name, images, manufacturer, specs, description
- Image gallery displays 4 view angles with clickable thumbnails
- Main image swaps when thumbnail is clicked
- Specs show formatted values (not raw numbers)
- Description is collapsible, collapsed by default
- Panel closes via backdrop click, X button, or Escape
- Loading state shows skeleton while fetching ship details
</success_criteria>

<output>
After completion, create `.planning/phases/05-ship-browse-and-display/05-04-SUMMARY.md`
</output>
