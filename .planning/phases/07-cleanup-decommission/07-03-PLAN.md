---
phase: 07-cleanup-decommission
plan: 03
type: execute
wave: 3
depends_on: ["07-01", "07-02"]
files_modified:
  - .eslintrc.json
autonomous: true

must_haves:
  truths:
    - "npm run build completes successfully with zero errors"
    - "Zero remaining references to any legacy ship identifier in src/"
    - "ESLint configuration extends valid next/core-web-vitals and next/typescript configs"
    - "Application builds without the discord.js/zlib-sync webpack error"
  artifacts:
    - path: ".eslintrc.json"
      provides: "Valid ESLint configuration for Next.js 15.3.3"
      contains: "next/core-web-vitals"
  key_links:
    - from: ".eslintrc.json"
      to: "npm run build"
      via: "ESLint pass during build"
      pattern: "extends.*next/core-web-vitals"
---

<objective>
Fix the ESLint build configuration and verify the entire application builds successfully with zero legacy references remaining.

Purpose: The build has been broken by an invalid ESLint config (`next/core-web-api` does not exist) and stale `@typescript-eslint` disable comments. This plan fixes the config, runs a comprehensive grep scan to confirm zero legacy identifiers remain, and performs a full `npm run build` as the final gate. This is the "clean slate" verification that the entire Dynamic Ship Database project (Phases 1-7) results in a fully buildable application.

Output: A passing `npm run build`, a valid ESLint configuration, and a comprehensive grep scan showing zero legacy references.
</objective>

<execution_context>
@C:\Users\dasbl\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dasbl\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-cleanup-decommission/07-CONTEXT.md
@.planning/phases/07-cleanup-decommission/07-RESEARCH.md
@.planning/phases/07-cleanup-decommission/07-01-SUMMARY.md
@.planning/phases/07-cleanup-decommission/07-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix ESLint configuration and clean stale disable comments</name>
  <files>.eslintrc.json</files>
  <action>
**Fix `.eslintrc.json`:**

The current config extends `"next/core-web-api"` which does not exist in `eslint-config-next@15.3.3`. The valid configs are:
- `next` (base)
- `next/core-web-vitals` (recommended)
- `next/typescript` (adds @typescript-eslint rules)

Update `.eslintrc.json` to:
```json
{
  "extends": ["next/core-web-vitals", "next/typescript"],
  "root": true,
  "parserOptions": {
    "project": "./tsconfig.json"
  }
}
```

This fixes two issues:
1. `next/core-web-api` -> `next/core-web-vitals` (the actual config name)
2. Adds `next/typescript` which loads the `@typescript-eslint` plugin, making `eslint-disable` comments referencing `@typescript-eslint` rules valid

**After updating the config, run `npx next lint` to check if the new config introduces any new lint errors across the codebase.** If it does, address them:
- For `@typescript-eslint/no-explicit-any` errors: add `// eslint-disable-next-line @typescript-eslint/no-explicit-any` comments OR fix the types if trivial.
- For `@typescript-eslint/no-require-imports` errors: these should already have disable comments from Phase 1 (ship-sync.ts uses require() for node-cron).
- For other new errors: use judgment -- fix if trivial, disable if the fix would be a rabbit hole.

The goal is `npm run build` passing, not a perfect lint score. Use targeted disable comments if needed to get the build green.

Commit: `fix(07): update ESLint config to valid next/core-web-vitals + next/typescript`
  </action>
  <verify>
Run `npx next lint` -- should complete without errors (or only warnings). Run `npm run type-check` -- should pass.
  </verify>
  <done>
ESLint configuration is valid. `npx next lint` runs without errors. The @typescript-eslint plugin is loaded via next/typescript.
  </done>
</task>

<task type="auto">
  <name>Task 2: Comprehensive legacy identifier scan and full build verification</name>
  <files></files>
  <action>
**Step 1: Run the comprehensive grep scan for legacy identifiers.**

Execute every grep from the research document's scan checklist. Each should return zero matches in `src/` (excluding `.planning/` and `node_modules/`):

```bash
echo "=== Legacy identifier scan ==="

# Core files should not exist
test ! -f public/data/ships.json && echo "PASS: ships.json" || echo "FAIL: ships.json"
test ! -f src/lib/ship-data.ts && echo "PASS: ship-data.ts" || echo "FAIL: ship-data.ts"
test ! -f src/types/ShipData.ts && echo "PASS: ShipData.ts" || echo "FAIL: ShipData.ts"
test ! -f src/types/test-dedup.js && echo "PASS: test-dedup.js" || echo "FAIL: test-dedup.js"
test ! -f public/assets/ship-placeholder.png && echo "PASS: placeholder" || echo "FAIL: placeholder"

# Function/identifier references (should be 0 in src/)
grep -r "loadShipDatabase" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "getShipsByManufacturer" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "formatShipImageName" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "getShipImagePath" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "getDirectImagePath" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "shipManufacturers" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "getShipByName" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "resolveShipImageLegacy" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "shipDetailsToMissionShip" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "_populateShipDatabaseCache" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "getShipDatabaseSync" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "isShipDatabaseLoaded" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "clearShipCache" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "ShipDetails" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "ship-placeholder" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "placeholder-ship" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "from.*ShipData" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "from.*ship-data" src/ --include="*.ts" --include="*.tsx" | wc -l
grep -r "ships\.json" src/ --include="*.ts" --include="*.tsx" | wc -l

echo "=== All counts should be 0 ==="
```

**If any grep returns non-zero:** Investigate and fix. These are residual references that were missed. Common cases:
- A comment mentioning the old function name -- remove or update the comment
- A file not covered by Plan 01/02 -- clean its imports and remove legacy usage
- A string literal mentioning the identifier -- update or remove

**Step 2: Run the full build.**

```bash
npm run build
```

This is the critical gate. The build must pass. Research identified that the ESLint config fix (Task 1) should resolve the build errors. If additional errors surface:

- **TypeScript errors about missing imports:** A file was missed in Plan 01. Fix the import.
- **Webpack/bundling errors about discord.js or zlib-sync:** The `next.config.js` already has `serverExternalPackages` for these. If the error persists, add the specific failing module to `serverExternalPackages` in `next.config.js`. Research confirmed the discord.js webpack externals are already partially configured.
- **ESLint errors from new `next/typescript` rules:** Add targeted disable comments. Do not remove the `next/typescript` extension.

**Step 3: If any fixes were needed in Step 1 or Step 2, commit them:**

`fix(07): resolve remaining legacy references and build errors`

**Step 4: Run the build one final time to confirm clean pass.**

The build log should show "Compiled successfully" or equivalent Next.js success message with no errors.
  </action>
  <verify>
`npm run build` exits with code 0. The comprehensive grep scan shows zero legacy identifier references. No FAIL lines in the file existence checks.
  </verify>
  <done>
Full `npm run build` passes. Zero legacy ship system identifiers remain in the source code. The Dynamic Ship Database project is complete -- the application builds end-to-end with the new system and zero traces of the old static system.
  </done>
</task>

</tasks>

<verification>
```bash
# Final build verification
npm run build

# Final grep scan (abbreviated -- key identifiers only)
echo "=== Final verification ==="
grep -rn "loadShipDatabase\|getShipsByManufacturer\|ShipDetails\|ship-placeholder\|from.*ShipData\|from.*ship-data" src/ --include="*.ts" --include="*.tsx" | wc -l
echo "(should be 0)"

# ESLint config is valid
npx next lint --quiet 2>&1 | tail -5
```
</verification>

<success_criteria>
- `npm run build` exits with code 0 (full build, not just type-check)
- `.eslintrc.json` extends `["next/core-web-vitals", "next/typescript"]`
- Comprehensive grep scan returns zero matches for all 19 legacy identifiers
- All 10 files from Plan 02 confirmed deleted
- No webpack errors related to discord.js or zlib-sync
- The entire Dynamic Ship Database project (Phases 1-7) is complete
</success_criteria>

<output>
After completion, create `.planning/phases/07-cleanup-decommission/07-03-SUMMARY.md`
</output>
