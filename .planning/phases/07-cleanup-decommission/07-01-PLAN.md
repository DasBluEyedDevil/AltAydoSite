---
phase: 07-cleanup-decommission
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/ships/image.ts
  - src/types/PlannedMission.ts
  - src/components/dashboard/MissionPlanner.tsx
  - src/components/dashboard/MissionPlannerForm.tsx
  - src/components/UserFleetBuilder.tsx
  - src/components/ships/ShipCard.tsx
  - src/components/ships/ShipCardList.tsx
autonomous: true

must_haves:
  truths:
    - "No live source file imports from ShipData.ts or ship-data.ts"
    - "No source file references ship-placeholder.png or placeholder-ship.png paths"
    - "Components display a CSS-only empty state when ship images fail to load"
    - "resolveShipImageLegacy function no longer exists in image.ts"
    - "shipDetailsToMissionShip function no longer exists in PlannedMission.ts"
  artifacts:
    - path: "src/lib/ships/image.ts"
      provides: "Ship image resolution without legacy section"
      contains: "getShipPlaceholder returns empty string"
    - path: "src/types/PlannedMission.ts"
      provides: "PlannedMission types without ShipData dependency"
    - path: "src/components/dashboard/MissionPlanner.tsx"
      provides: "Mission planner without loadShipDatabase dependency"
    - path: "src/components/ships/ShipCard.tsx"
      provides: "Ship card with CSS-only image error state"
    - path: "src/components/ships/ShipCardList.tsx"
      provides: "Ship card list with CSS-only image error state"
  key_links:
    - from: "src/components/dashboard/MissionPlanner.tsx"
      to: "src/types/PlannedMission.ts"
      via: "import (no longer imports ShipData)"
      pattern: "from '@/types/PlannedMission'"
    - from: "src/lib/ships/image.ts"
      to: "components"
      via: "getShipPlaceholder returns empty string"
      pattern: "return ''"
---

<objective>
Remove all legacy ship system imports from live source files and replace placeholder image fallbacks with CSS-only empty states.

Purpose: Sever all dependency chains from live code to the legacy files (ShipData.ts, ship-data.ts) so those files can be safely deleted in Plan 02. Also replaces the soon-to-be-deleted ship-placeholder.png references with CSS empty states matching the existing pattern from FleetShipPickerModal (06-02).

Output: All live source files are free of legacy imports and placeholder image paths. The codebase will have type errors on the legacy files themselves (since their consumers are cleaned), but no live route depends on them.
</objective>

<execution_context>
@C:\Users\dasbl\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dasbl\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-cleanup-decommission/07-CONTEXT.md
@.planning/phases/07-cleanup-decommission/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean legacy imports and remove legacy functions from library files</name>
  <files>
    src/lib/ships/image.ts
    src/types/PlannedMission.ts
    src/components/dashboard/MissionPlanner.tsx
  </files>
  <action>
**src/lib/ships/image.ts:**
1. Remove the entire "Legacy Support" section (lines 77-104): the import of `getDirectImagePath` and `getShipByName` from `@/types/ShipData`, and the entire `resolveShipImageLegacy()` function.
2. Update `getShipPlaceholder()` to return an empty string instead of `'/assets/ship-placeholder.png'`. Components will handle empty/falsy image URLs via CSS empty states.

The file should retain: `ShipImageView`, `ShipImages`, `viewMap`, `resolveShipImage()`, and the updated `getShipPlaceholder()`.

**src/types/PlannedMission.ts:**
1. Remove the import: `import { ShipDetails } from './ShipData';`
2. Remove the `shipDetailsToMissionShip()` function entirely (lines 172-183). It is superseded by `shipDocumentToMissionShip()` in `src/lib/ships/mappers.ts` and has zero callers in the codebase.
3. Update the comment on `MissionShip.image` from "Ship image URL -- Kept optional for transition; removed in Phase 7" to just "Ship image URL (FleetYards CDN)". The field stays -- it stores the image URL captured at mission creation time.
4. Keep everything else (MissionShip, MissionLeader, PlannedMission, createEmptyMission, etc.).

**src/components/dashboard/MissionPlanner.tsx:**
1. Remove the import: `import { ShipDetails } from '@/types/ShipData';`
2. Remove the import: `import { loadShipDatabase } from '@/lib/ship-data';`
3. Remove the state declarations: `const [ships, setShips] = useState<ShipDetails[]>([]);` and `const [shipsLoading, setShipsLoading] = useState(true);`
4. Remove the useEffect that calls `loadShipDatabase()` (lines 150-156).
5. At line 553-555, where crew count is calculated using `ships.find(sd => sd.name === ship.shipName)`, replace with a simpler approach: just sum `ship.quantity` (the crew lookup from the static database was used to estimate total crew, but that data is not reliably available without the static DB). Change the crew calculation to simply count total ships: `return (mission.ships || []).reduce((total, ship) => total + ship.quantity, 0);` and update the label from "crew" to "ships" if it currently says "crew".
6. Replace the two placeholder image references:
   - Line 640: `src={mission.ships[0].image || '/images/placeholder-ship.png'}` -- change to use an `imgError` state pattern OR a simpler inline approach: if `mission.ships[0].image` is falsy, render a CSS empty state div instead of an Image. Use the pattern:
     ```tsx
     {mission.ships[0].image ? (
       <Image src={mission.ships[0].image} alt={mission.ships[0].shipName} ... />
     ) : (
       <div className="flex items-center justify-center w-full h-full bg-[rgba(var(--mg-panel-dark),0.6)] border border-[rgba(var(--mg-primary),0.15)] rounded">
         <span className="text-xs text-[rgba(var(--mg-primary),0.3)]">No image</span>
       </div>
     )}
     ```
   - Line 957: Same pattern for `src={ship.image || '/images/placeholder-ship.png'}`.

   Note: These use `/images/placeholder-ship.png` (different from the standard `/assets/ship-placeholder.png`). Both must be eliminated.
  </action>
  <verify>
Run `npm run type-check` -- it may show errors for the legacy files themselves (ShipData.ts, ship-data.ts) but should NOT show errors in the modified files. Grep for `ShipData`, `ship-data`, `loadShipDatabase`, `resolveShipImageLegacy`, `shipDetailsToMissionShip`, `placeholder-ship` in the modified files -- zero matches.
  </verify>
  <done>
MissionPlanner.tsx, PlannedMission.ts, and image.ts have zero imports from ShipData.ts or ship-data.ts. The resolveShipImageLegacy function and shipDetailsToMissionShip function no longer exist. MissionPlanner.tsx no longer calls loadShipDatabase().
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace placeholder image fallbacks with CSS empty states in remaining components</name>
  <files>
    src/components/UserFleetBuilder.tsx
    src/components/dashboard/MissionPlannerForm.tsx
    src/components/ships/ShipCard.tsx
    src/components/ships/ShipCardList.tsx
  </files>
  <action>
Replace all references to `/assets/ship-placeholder.png` with CSS-only empty states. Use the pattern already established in FleetShipPickerModal (06-02):

```tsx
// When image is missing or errors:
<div className="flex items-center justify-center w-full h-full bg-[rgba(var(--mg-panel-dark),0.6)] border border-[rgba(var(--mg-primary),0.15)] rounded">
  <span className="text-xs text-[rgba(var(--mg-primary),0.3)]">No image</span>
</div>
```

For each file, find the `onError` handler that sets the image source to the placeholder, and instead have it set an error flag (`setImgError(true)` or similar). Then conditionally render either the Image component or the CSS placeholder based on the error flag.

**src/components/UserFleetBuilder.tsx** (line ~121):
- Find where `'/assets/ship-placeholder.png'` is used as a fallback. Replace the image error handling to use a boolean state + CSS empty state div. The component already uses `resolveShipImage` from the new system -- the placeholder reference is the onError fallback.

**src/components/dashboard/MissionPlannerForm.tsx** (line ~632):
- Find `ship.image || '/assets/ship-placeholder.png'` and replace with conditional render: if `ship.image` is truthy, show Image; if falsy, show CSS empty state div.

**src/components/ships/ShipCard.tsx** (line ~44):
- This component likely already has an `imgError` state from Phase 5. Update the fallback from `setImgSrc('/assets/ship-placeholder.png')` to `setImgError(true)` and render the CSS empty state when `imgError` is true.

**src/components/ships/ShipCardList.tsx** (line ~35):
- Same pattern as ShipCard. Replace placeholder path with error state + CSS empty state.

Important: Read each file first to understand its current image error handling pattern before modifying. Some may already have `imgError` state; others may set the src to the placeholder on error. Adapt the approach to each file's existing pattern.
  </action>
  <verify>
Grep for `ship-placeholder` and `placeholder-ship` across all `src/` files -- zero matches. Grep for `/assets/ship-placeholder.png` -- zero matches. Run `npm run type-check` to confirm no type errors in modified files.
  </verify>
  <done>
All four components use CSS-only empty states for missing/errored ship images. Zero references to any placeholder PNG remain in source files.
  </done>
</task>

</tasks>

<verification>
```bash
# Verify no live file imports legacy modules
grep -r "from.*ShipData" src/ --include="*.ts" --include="*.tsx" | grep -v "node_modules" | grep -v "ShipData.ts"
grep -r "from.*ship-data" src/ --include="*.ts" --include="*.tsx" | grep -v "node_modules" | grep -v "ship-data.ts"

# Verify no placeholder image references
grep -r "ship-placeholder" src/ --include="*.ts" --include="*.tsx"
grep -r "placeholder-ship" src/ --include="*.ts" --include="*.tsx"

# Verify removed functions don't exist in modified files
grep -r "resolveShipImageLegacy" src/lib/ships/image.ts
grep -r "shipDetailsToMissionShip" src/types/PlannedMission.ts
grep -r "loadShipDatabase" src/components/dashboard/MissionPlanner.tsx
```
All greps should return zero matches.
</verification>

<success_criteria>
- Zero imports from `@/types/ShipData` in any file except ShipData.ts itself
- Zero imports from `@/lib/ship-data` in any file except ship-data.ts itself
- Zero references to any placeholder PNG path in source files
- `resolveShipImageLegacy` removed from image.ts
- `shipDetailsToMissionShip` removed from PlannedMission.ts
- `loadShipDatabase` removed from MissionPlanner.tsx
- CSS-only empty states used for all ship image error handling
</success_criteria>

<output>
After completion, create `.planning/phases/07-cleanup-decommission/07-01-SUMMARY.md`
</output>
